<!DOCTYPE html>
<html>

<head>
    <title>Logging - {{ habit.name }}</title>
    <link rel="stylesheet" href="/static/style.css">
</head>

<body>
    <div class="window">
        <div class="title-bar">
            <div class="title-bar-text">Log Entry: {{ habit.name }}</div>
            <div class="title-bar-controls">
                <div class="title-btn">?</div>
                <div class="title-btn">X</div>
            </div>
        </div>

        <div class="window-body">
            <div style="margin-bottom: 20px;">
                <a href="/habits">
                    << Back to Manager</a>
            </div>

            <h2>Log Activity</h2>
            <form method="post" action="/habits/{{ habit.id }}/form">
                <label style="display: block; margin-bottom: 5px;">Duration (minutes):</label>
                <input type="number" name="value" placeholder="0" required>

                <label style="display: block; margin-bottom: 5px;">Notes:</label>
                <input type="text" name="note" placeholder="Optional details...">

                <button type="submit">Save Entry</button>
                <a href="/habits/{{ habit.id }}/stats" style="margin-left: 10px;">View Stats</a>
            </form>

            <div style="margin: 20px 0; border-top: 2px solid #808080; border-bottom: 2px solid #ffffff; height: 0;">
            </div>

            <div style="display: flex; gap: 20px;">
                <div style="flex: 1;">
                    <h3>Recent Logs</h3>
                    <div
                        style="height: 150px; overflow-y: auto; background: white; border: 2px inset gray; padding: 5px;">
                        {% for log in logs|reverse %}
                        <div
                            style="margin-bottom: 4px; border-bottom: 1px dotted #ccc; padding-bottom: 4px; display: flex; justify-content: space-between; align-items: start;">
                            <div>
                                <strong>{{ log.date }}</strong>: {{ log.value }} min<br>
                                <span style="font-size: 11px; font-style: italic;">{{ log.note or "" }}</span>
                            </div>
                            <form action="/logs/{{ log.id }}/delete" method="post" style="margin: 0; display: inline;">
                                <button type="submit" class="delete-btn" title="Delete Log"
                                    style="font-size: 18px !important; font-weight: bold !important; line-height: 1;">&times;</button>
                            </form>
                        </div>
                        {% else %}
                        <div>No logs recorded.</div>
                        {% endfor %}
                    </div>
                </div>

                <div style="flex: 1;">
                    <h3>Daily Summaries</h3>
                    <div
                        style="height: 150px; overflow-y: auto; background: white; border: 2px inset gray; padding: 5px;">
                        {% for row in grouped_logs|reverse %}
                        <div style="margin-bottom: 4px;">
                            <strong>{{ row.date }}</strong>: {{ row.total_value }} min total
                        </div>
                        {% else %}
                        <div>No data.</div>
                        {% endfor %}
                    </div>
                </div>
            </div>

            <div class="status-bar">
                Active Habit: {{ habit.name }}
            </div>
        </div>
    </div>
    <!-- Confirmation Modal -->
    <div id="confirmModal" class="modal-overlay">
        <div class="modal-window">
            <div class="modal-title">Remove Log?</div>
            <div class="modal-text">Are you sure you want to delete this log entry?</div>
            <div class="modal-actions">
                <button id="cancelBtn" class="btn-secondary" style="min-width: 80px;">Cancel</button>
                <button id="confirmBtn" class="btn-danger" style="min-width: 80px;">Delete</button>
            </div>
        </div>
    </div>

    <script src="/static/script/confirm-modal.js"></script>
</body>

</html>